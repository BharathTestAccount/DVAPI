<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Challenges</title>

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">

</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- MENU SIDEBAR-->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <img src="images/icon/logo.png" alt="Cool Admin" />
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
                <nav class="navbar-sidebar">
                    <ul class="list-unstyled navbar__list">
                        <li>
                            <a href="/challenges">
                                <i class="fas fa-tachometer-alt"></i>Challenges</a>
                        </li>
                        <li>
                            <a href="/Swagger">
                                <i class="fa fa-arrow-circle-o-right"></i>API Swagger</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="header-wrap">
                            <div class="header-button" style="position:absolute;right:0px; margin: 25px;">
                                <div class="noti-wrap">
                                    <div class="noti__item js-item-menu">
                                        <i class="fa fa-ticket" onclick="document.getElementById('ticket-button').click();"></i>
                                    </div>
                                </div>
                                <div class="account-wrap">
                                    <div class="account-item clearfix js-item-menu">
                                        <div class="image">
                                            <img src="/uploads/<%= user.profilePic %>" alt="" />
                                        </div>
                                        <div class="content">
                                            <a class="js-acc-btn" href="#"><%= user.username %></a>
                                        </div>
                                        <div class="account-dropdown js-dropdown">
                                            <div class="info clearfix">
                                                <div class="image">
                                                    <a href="/profile">
                                                        <img src="/uploads/<%= user.profilePic %>" alt="" />
                                                    </a>
                                                </div>
                                                <div class="content">
                                                    <h5 class="name">
                                                        <a href="/profile"><%= user.username %></a>
                                                    </h5>
                                                    <h5 class="name">
                                                        <span>Score: <%= user.score %></span>
                                                    </h5>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__body">
                                                <div class="account-dropdown__item">
                                                    <a href="/profile">
                                                        <i class="zmdi zmdi-account"></i>Account</a>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__footer">
                                                <a href="/logout">
                                                    <i class="zmdi zmdi-power"></i>Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- HEADER DESKTOP-->

            <!-- MAIN CONTENT-->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <h4>Progress</h4>
                        <br>
                        <div class="progress ">
                            <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" id="progressbar-strip" role="progressbar" style="width: 0%" aria-valuenow="0"
                             aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                        <div class="row">
                            <!-- Use for loop to loop all challenges -->
                            
                            
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API1:2023 Broken Object Level Authorization
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-1"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            BOLA vulnerabilities can arise when the object access is not properly checked for user authorization. Proper object level authorization should be implemented on all API endpoints that perform CRUD operations on objects.                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-1" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API2:2023 Broken Authentication
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-2">Solved</span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            Authentication endpoints, which are typically public-facing, are a common target for attackers. To prevent attacks, these endpoints should have extra protection measures in place. However, misconfigurations can occur due to insufficient threat modeling.                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-2" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API3:2023 Broken Object Property Level Authorization
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-3"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            APIs perform actions on objects and their properties. Developers may neglect property level authorization, allowing users to modify object properties they shouldn't access, despite having object level authorization.                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-3" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API4:2023 Unrestricted Resource Consumption
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-4"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            API requests consume resources such as CPU/memory, bandwidth, storage, and integrations with other services. Attackers can cause high resource consumption by sending excessive requests, leading to unresponsive APIs or increased business expenses.                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-4" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API5:2023 Broken Function Level Authorization
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-5"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            APIs enable users to perform specific functions on API objects, with some of these functions restricted to certain user permissions. It is crucial to implement proper authorization checks for API functions to ensure users are granted the correct privileges for object manipulation.                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-5" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API6:2023 Server Side Request Forgery
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-6"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            Server-Side Request Forgery (SSRF) flaws occur whenever an API is fetching a remote resource without validating the user-supplied URL. It allows an attacker to coerce the application to send a crafted request to an unexpected destination, even when protected by a firewall or a VPN.
                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-6" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API7:2023 Security Misconfiguration
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-7"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            A security misconfiguration arises when essential security settings are either not implemented or implemented with errors
                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-7" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API8:2023 Lack of Protection from Automated Threats
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-8"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            An automated threat is a type of computer security threat to a computer network or web application, characterised by the malicious use of automated tools such as Internet bots, Using large amounts of repetitive tasks with almost no cost to execute.
                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-8" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API9:2023 Improper Inventory Management

                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-9"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            Improper management of APIs refers to instances when the production APIs are built, utilized, and then no longer managed without being terminated. 
                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-9" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            <!-- Challenge card -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <strong class="card-title">API10:2023 Unsafe Consumption of APIs
                                            <small>
                                                <span class="badge badge-success float-right mt-1" id="challenge-card-10"></span>
                                            </small>
                                        </strong>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            Developers tend to trust data received from third-party APIs more than user input. This is especially true for APIs offered by well-known companies. Because of that, developers tend to adopt weaker security standards, for instance, in regards to input validation and sanitization.

                                        </p>
                                        <br>
                                        <!-- <br> -->
                                        <div class="input-group">
                                            <form id="challenge-10" class="flag-submit-form">
                                                <input type="text" id="flag" name="flag" placeholder="Flag" class="form-control">
                                                <br>
                                                <div class="input-group-btn">
                                                    <button class="btn btn-primary">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Challenge card -->
                            
                            <script>
                                var forms = document.querySelectorAll(".flag-submit-form");
                                forms.forEach(function(form) {
                                    form.addEventListener("submit", function(event) {
                                        event.preventDefault();
                                        var challengeNo = this.getAttribute("id").split('-')[1];
                                        const formData = new FormData(this);
                                        formObj =  Object.fromEntries(formData);
                                        formObj.challengeNo = challengeNo;
                                        form.getElementsByTagName('input')[0].value = "";
                                        // alert(JSON.stringify(formObj));
                                        // do something with the form data
                                        fetch("/api/flag/submit", {
                                                        method: "POST",
                                                        body: JSON.stringify(formObj),
                                                        headers: { "Content-Type": "application/json" }
                                                    })
                                                    .then(r => r.json())
                                                    .then(data => {
                                                        if (data.status === "success") {
                                                            alert(data.message);
                                                            updateProgressBar(data);
                                                        }
                                                        else {
                                                            alert(data.message);
                                                        }
                                                    })
                                                    .catch(console.error);
                                    });
                                });
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <!-- modal for ticket -->
            <div class="col-md4" style="margin-left: 50%; margin-right: 10%;">
                <button type="button" hidden id="ticket-button" class="btn btn-secondary mb-1" data-toggle="modal" data-target="#mediumModal">
                    Have any question on a challenge? Create a ticket.
                </button>
            </div>
            <div class="modal fade" id="mediumModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="mediumModalLabel">Have any query regarding a challenge? Create a ticket!</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <form action="" method="post" id="ticket-form">
                            <div class="modal-body">
                                <textarea id="message" rows="4" name="message" class="form-control" maxlength="500"></textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" id="close-modal" data-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Confirm</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- end modal -->
        </div>
        <!-- END PAGE CONTAINER-->
        <script>
            const ticketForm = document.getElementById("ticket-form");
            ticketForm.addEventListener("submit", e => {
            e.preventDefault();
            const formData = new FormData(ticketForm);
            fetch("/api/addTicket", {
                method: "POST",
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: { "Content-Type": "application/json" }
            })
            .then(r => r.json())
            .then(data => {
                var icon = document.querySelector('.fa-ticket');
                var originalColor = "rgb(169, 179, 201)";
                icon.style.color = 'green';
                try {
                    if (data.status === "success") {
                        icon.style.color = 'green';
                    }
                    else {
                        icon.style.color = 'red';
                    }
                }
                catch {
                    icon.style.color = 'red';
                }
                setTimeout(function() {
                    icon.style.color = originalColor;
                }, 3000);
                document.getElementById('close-modal').click();
                document.getElementById('message').value = "";
            })
            .catch(console.error);
            });
            document.getElementById('close-modal').click();
        </script>
        <script>
            // Obtain the challenge solves for the user
            function updateProgressBar(data) {
                var solves = data.solves;
                var solveCount = 0;
                for (var i = 1; i <= 10; i++) {
                    if (solves[i] === 1) {
                        $('#challenge-card-' + i).text('Solved').attr('class', 'badge badge-success float-right mt-1');
                        solveCount += 1;
                    }
                    if (solves[i] === 0) {
                        $('#challenge-card-' + i).text('Not solved').attr('class', 'badge badge-danger float-right mt-1');
                    }
                }
                var solvePercentage = solveCount * (100/10);
                $('#progressbar-strip').attr('style', `width: ${solvePercentage}%`).attr('aria-valuenow',`${solvePercentage}`).text(`${solvePercentage}`);
            }
            function getSolves(){
                fetch('/api/getSolves')
                .then(response => response.json())
            .then(data => {
                updateProgressBar(data);
                // <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" role="progressbar" style="width: 25%" aria-valuenow="25"
                //              aria-valuemin="0" aria-valuemax="100">25%</div>
                
            })
            .catch(error => console.error(error));
            }
            getSolves();
        </script>
    </div>

    <!-- Jquery JS-->
    <script src="vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="vendor/slick/slick.min.js">
    </script>
    <script src="vendor/wow/wow.min.js"></script>
    <script src="vendor/animsition/animsition.min.js"></script>
    <script src="vendor/bootstrap-progressbar/bootstrap-progressbar.min.js">
    </script>
    <script src="vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="vendor/counter-up/jquery.counterup.min.js">
    </script>
    <script src="vendor/circle-progress/circle-progress.min.js"></script>
    <script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="vendor/select2/select2.min.js">
    </script>

    <!-- Main JS-->
    <script src="js/main.js"></script>

</body>

</html>
<!-- end document-->
